<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>User Post Recommendations</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
html, body { height: 100%; font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; overflow-x: hidden; }

/* Subtle gradient background */
body {
    background: linear-gradient(135deg, #e0eafc, #cfdef3);
}

/* Canvas for floating bubbles */
#bgCanvas {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    z-index: -1;
}

/* Container */
.container { position: relative; max-width: 1000px; margin: auto; padding: 20px; }

/* Heading */
h1 {
    text-align: center;
    color: #37474f;
    font-size: 2rem;
    margin-bottom: 20px;
}

/* User selector */
.user-selector {
    display: flex;
    overflow-x: auto;
    white-space: nowrap;
    padding: 10px 0;
    margin-bottom: 25px;
    border-bottom: 1px solid #cfd8dc;
    scroll-behavior: smooth;
}
.user-selector::-webkit-scrollbar { height: 8px; }
.user-selector::-webkit-scrollbar-track { background: #eceff1; border-radius: 4px; }
.user-selector::-webkit-scrollbar-thumb { background: #90a4ae; border-radius: 4px; }

/* User buttons */
.user-btn {
    flex: 0 0 auto;
    padding: 10px 20px;
    margin: 0 8px;
    border-radius: 20px;
    border: none;
    font-weight: 600;
    cursor: pointer;
    transition: transform 0.2s, box-shadow 0.2s, background 0.2s;
    color: #37474f;
    background: #cfd8dc;
}
.user-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    background: #b0bec5;
}
.user-btn.active {
    background: #78909c;
    color: white;
}

/* Post feed */
.post-feed { display: flex; flex-direction: column; gap: 15px; }

.post-card {
    border-radius: 12px;
    padding: 15px;
    color: #37474f;
    background: #ffffff;
    box-shadow: 0 2px 6px rgba(0,0,0,0.08);
    transition: transform 0.2s, box-shadow 0.2s, filter 0.2s;
}
.post-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 6px 15px rgba(0,0,0,0.12);
    filter: brightness(1.05);
}

.post-id { font-size: 0.85rem; font-weight: bold; opacity: 0.7; margin-bottom: 8px; }

/* Responsive */
@media (max-width: 768px) {
    h1 { font-size: 1.8rem; }
    .user-btn { padding: 8px 16px; margin: 0 6px; font-size: 0.9rem; }
    .post-card { padding: 12px; font-size: 0.95rem; }
}
@media (max-width: 480px) {
    h1 { font-size: 1.6rem; }
    .user-btn { padding: 6px 12px; font-size: 0.85rem; }
    .post-card { padding: 10px; font-size: 0.9rem; }
}
</style>
</head>
<body>

<canvas id="bgCanvas"></canvas>

<div class="container">
    <h1>Personalized Post Feed</h1>
    <div id="userSelector" class="user-selector"></div>
    <div id="postFeed" class="post-feed"></div>
</div>

<script>
// --- Soft Floating Bubbles ---
const canvas = document.getElementById('bgCanvas');
const ctx = canvas.getContext('2d');
let w = canvas.width = window.innerWidth;
let h = canvas.height = window.innerHeight;

class Bubble {
    constructor() {
        this.x = Math.random() * w;
        this.y = Math.random() * h;
        this.radius = 20 + Math.random() * 40;
        this.speedY = 0.1 + Math.random() * 0.3;
        this.alpha = 0.2 + Math.random() * 0.2;
        this.color = `rgba(255, 255, 255, ${this.alpha})`;
    }
    draw() {
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.radius, 0, Math.PI*2);
        ctx.fillStyle = this.color;
        ctx.fill();
    }
    update() {
        this.y -= this.speedY;
        if(this.y + this.radius < 0) this.y = h + this.radius;
        this.draw();
    }
}

const bubbles = [];
for(let i=0; i<25; i++) bubbles.push(new Bubble());

function animate() {
    ctx.clearRect(0,0,w,h);
    bubbles.forEach(b => b.update());
    requestAnimationFrame(animate);
}
animate();

window.addEventListener('resize', () => { w = canvas.width = window.innerWidth; h = canvas.height = window.innerHeight; });

// --- User Feed Logic (same as before) ---
const userSelector = document.getElementById('userSelector');
const postFeed = document.getElementById('postFeed');

let recommendations = {};
let posts = {};

function displayPostsForUser(userId) {
    postFeed.innerHTML = '';
    const recommendedPostIds = recommendations[userId];
    if (!recommendedPostIds || recommendedPostIds.length === 0) {
        postFeed.innerHTML = '<div class="post-card"><p>No recommendations for this user.</p></div>';
        return;
    }
    recommendedPostIds.forEach(postId => {
        const postContent = posts[postId] || "Content not available.";
        const postCard = document.createElement('div');
        postCard.className = 'post-card';
        postCard.innerHTML = `<div class="post-id">POST ID: ${postId}</div>
                              <div class="post-content">${postContent}</div>`;
        postFeed.appendChild(postCard);
    });
}

function setActiveUser(button) {
    const currentActive = document.querySelector('.user-btn.active');
    if (currentActive) currentActive.classList.remove('active');
    button.classList.add('active');
}

async function initialize() {
    try {
        const response = await fetch('/api/data');
        const data = await response.json();
        recommendations = data.recommendations;
        posts = data.posts;

        const userIds = Object.keys(recommendations);
        userSelector.innerHTML = '';

        userIds.forEach(uid => {
            const btn = document.createElement('button');
            btn.className = 'user-btn';
            btn.textContent = `User ${uid}`;
            btn.addEventListener('click', () => {
                setActiveUser(btn);
                displayPostsForUser(uid);
            });
            userSelector.appendChild(btn);
        });

        if(userIds.length > 0){
            const firstBtn = userSelector.firstChild;
            setActiveUser(firstBtn);
            displayPostsForUser(userIds[0]);
        }

    } catch(err) {
        console.error(err);
        postFeed.innerHTML = `<div class="post-card"><p>Error loading data. Check console.</p></div>`;
    }
}

document.addEventListener('DOMContentLoaded', initialize);
</script>

</body>
</html>
